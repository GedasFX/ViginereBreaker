# Homework 1

By Gediminas Milašius 201678IVCM.

## Cyphertext

```
XHWLISAMYALBSNKTWRWVELDXHBQIPALHENVTWVAOMDDRECLXHUHHRBQVSRLXDHSOIAUHQMGGENVBRTWKISLBRGMGHEJECIFZPOYBGNGMMCWMLALMLEKHPDAXVSSKINGMQOLBZALXHTGKITJXETBNWTGKIVWGQAAGPYTRXHWBVRSMMOFTPAKLISKFINLHJTZXHAFZIRKHJBSMXLWTRDTRXHWBVSWEJIFMIRWLXRSMLEJMLEQWMSUHZEJTWOMGHRWTWOFMSRMGEWSRFYJXELASMNYMLALPLALBXMSDISKXRSWYSRLAIMLHHOVXTEFWWOFPLALBXWAEPMSDISWGWEXHVOLAIRKMSDGTRDLAETSEPOXMLEGMLEJLGAFGSTAVITZBWTGHIVWGEQMBXETKEVWLSLVBIRETCPJXJEJMSRMGVALAIRLAENZXVOAVELDRFULISIFMPEKLPYVBITJRMNYMSSLXQTZXSNUHQIFZXIVXELDUCHAFWEDYXHMLAEUHYLVBQAYBREOBXHGNXCGGXRSWMCLBSNSVMRUNQSLTRCWBRWZBGHSGERERELDHJWZHWEEXQBWKWAJXFRSOIFDXISSMXOHLTEWWFEXHVELAIEFXQYETOEKTQONXMFLAISGEHIWKWRWTPLQTVETKEVWMLEFMLIKLYRWECIKGXTZXSULVSMWTRYGYXHWFAAFMIDWTGHOHYLVAEVWIVEXXVRWWXHSMELDLXAFWENVYMGZMAHSMAEZTZEZXVELAINALECSLIIFPLIUAXHWBRTWKECLBSNGYQAFRMNVBZIVNELDRVALBSNSEHEUBWIGGQACBRGHKSCWLWEKHREHKSCWLWPWKWODWMEJIVOVNGEKTROMMGOEXMNLXRDWWFYFHSNWFSSLTVMAXWTJRXOSOSIVMLIKIVOTEIMBNWTSLGOJMIZVBHSAGGELAIYUTRTMLYADECMSDIRWMVESMTHQLMCSEPYAFTOKLMBDXXHWRQACXMTWVSNGFMCSEPYAFTOKLMBDXXHWRWHGHXDWLIRLXVSLAINKMENVBRGSGHFAZLTAGKIKXECZLSLVBIRKBRDAOMDMTPLQKETAHRADVSUJLIOXTGTAHRAXMIRSEPBWVEUKXXHWVSSLHJRMGRIFZMSKNVELHFESMPESLXAKAMGZTWTZXGOKMSFKMEYAGK
```

## Cracking the cyphertext

Cracking the cyphertext will consist of the following steps:

1. Determining cyphertext cypher method;
2. Deciphering the text using the adequate methods.

For the case of Viginere cypher, the steps I use are as follows:

1. Key length analysis;
2. Find distance between keys;
3. Manual verification;

### Key length analysis

#### Kasiski examination

I used an [PLANETCALC online calculator](https://planetcalc.com/8550/) to find repeating trigrams from the given cyphertext, and calculate the distances between them. 5 repeating trigrams were found:

| Trigram | First occurrence | Distance to next occurrence         | GCD  |
| ------- | ---------------- | ----------------------------------- | ---- |
| XHW     | 0                | 164, 212, 688, 772, 984, 1016, 1120 | 4    |
| LAI     | 302              | 40, 124, 308, 328, 452, 636, 732    | 4    |
| ELD     | 20               | 420, 468, 544, 704, 780             | 4    |
| MLE     | 111              | 120, 124, 252, 256, 544             | 4    |
| VEL     | 19               | 420, 589, 733, 1121                 | 1    |

This analysis shows that the key length is likely to be 4 (online tool, assumes it could be 2, I assume it got lost because of the fluke `VEL` trigram).

#### Partial Texts

Checking the indices of coincidence after splitting the text in to 4 chunks, leads us to the following ICs:
$$
IC(Y_1)=0.0641; 
IC(Y_2)=0.0634;
IC(Y_3)=0.0708;
IC(Y_4)=0.0670;
$$
All of the indices have coefficient greater than 0.057, which indicates that the key length of 4 is very likely to be correct.

### Find distance between keys

We are given m = 4:

Y1 - encrypted with a1 = a1 + z1 = a1 + 0
Y2 - encrypted with a2 = a1 + z2
Y3 - encrypted with a3 = a1 + z3
Y4 - encrypted with a4 = a1 + z4

Find z2, z3, z4.

#### Brute force

All 4 groups were compared in groups of 2 (in my case it was 4 choose 2 = 6 comparison groups). For all of those groups, one of the ciphertexts was offset by 0 to 26 letters and for each iteration a mutual index of coincidence was calculated. For every group the maximum of the indices was taken for result.

Results:

```
Calculated offsets based on the Mutual IC:
Offset   4, between columns  1 and  2. (z1-z2)
Offset  12, between columns  1 and  3. (z1-z3)
Offset  11, between columns  1 and  4. (z1-z4)
Offset   8, between columns  2 and  3. (z2-z3)
Offset   7, between columns  2 and  4. (z2-z4)
Offset  25, between columns  3 and  4. (z3-z4)
```

This leaves us with:
$$
z_1=0; z_2=4;z_3=12;z_4=11
$$

### Manual verification

One way to improve the algorithm would be to detect English text, bus as for now, the user gets 26 different versions of key and plaintext combos.

Sample (3 out of 26 lines are shown):

```
4) Key: DZRS. Plaintext: UIFTFTJUVBUJPOTBTSFDBMMFECZQMBUPBOEBTWJWJEMZBDUFEVQPOCZDPSUFAIBWFBDPNNPOBOEJOUFSFTUJOHVOEFSMZJOHMPHJDOPUJDFUIBUUIFTPMEJFSTBSFOPUNPUJWBUFEUPSFUSFBUKVTUPSFWFONBJOMZCZUIFJSSBUJPOBMBTTFTTNFOUPGUIFEBOHFSTPGCBUUMFBOECZUIFJSTFMGJOUFSFTUSBUIFSUIFZEJTDPWFSBTPVOESFBTPOUPSVOBXBZCZSFBMJAJOHUIBUXIBUJUNBLFTTFOTFGPSUIFNUPEPEFQFOETPOXIBUJUXJMMNBLFTFOTFGPSPUIFSTUPEPBOEUIBUBMMPGUIFPUIFSTDBOOPUJDFUIJTUPPFWFOBRVJUFCSBWFTPMEJFSNBZQSFGFSUPSVOSBUIFSUIBOIFSPJDBMMZCVUQPJOUMFTTMZEJFUSZJOHUPTUFNUIFPODPNJOHUJEFBMMCZIJNTFMGUIVTXFDPVMEJNBHJOFXJUIPVUDPOUSBEJDUJPOBDJSDVNTUBODFJOXIJDIBOBSNZBMMPGXIPTFNFNCFSTBSFCSBWFGMFFTBUUPQTQFFECFGPSFUIFFOFNZNBLFTBNPWFJGUIFTPMEJFSTSFBMMZBSFCSBWFUIFOUIJTTVSFMZJTOUUIFPVUDPNFBOZPGUIFNXBOUFEFBDIXPVMEIBWFQSFGFSSFEUIBUBMMTUBOEBOEGJHIUXIBUXFIBWFIFSFUIFOJTBDBTFJOXIJDIUIFJOUFSBDUJPOPGNBOZJOEJWJEVBMMZSBUJPOBMEFDJTJPONBLJOHQSPDFTTFTPOFQSPDFTTQFSTPMEJFSQSPEVDFTBOPVUDPNFJOUFOEFECZOPPOFNPTUBSNJFTUSZUPBWPJEUIJTQSPCMFNKVTUBTDPSUFAEJETJODFUIFZDBOUVTVBMMZNBLFSFUSFBUQIZTJDBMMZJNQPTTJCMFUIFZNBLFJUFDPOPNJDBMMZJNQPTTJCMFUIFZTIPPUEFTFSUFSTUIFOTUBOEJOHBOEGJHIUJOHJTFBDITPMEJFSTJOEJWJEVBMMZSBUJPOBMDPVSTFPGBDUJPOBGUFSBMMCFDBVTFUIFDPTUPGSVOOJOHJTTVSFUPCFBUMFBTUBTIJHIBTUIFDPTUPGTUBZJOH
5) Key: EAST. Plaintext: THESESITUATIONSASRECALLEDBYPLATOANDASVIVIDLYACTEDUPONBYCORTEZHAVEACOMMONANDINTERESTINGUNDERLYINGLOGICNOTICETHATTHESOLDIERSARENOTMOTIVATEDTORETREATJUSTOREVENMAINLYBYTHEIRRATIONALASSESSMENTOFTHEDANGERSOFBATTLEANDBYTHEIRSELFINTERESTRATHERTHEYDISCOVERASOUNDREASONTORUNAWAYBYREALIZINGTHATWHATITMAKESSENSEFORTHEMTODODEPENDSONWHATITWILLMAKESENSEFOROTHERSTODOANDTHATALLOFTHEOTHERSCANNOTICETHISTOOEVENAQUITEBRAVESOLDIERMAYPREFERTORUNRATHERTHANHEROICALLYBUTPOINTLESSLYDIETRYINGTOSTEMTHEONCOMINGTIDEALLBYHIMSELFTHUSWECOULDIMAGINEWITHOUTCONTRADICTIONACIRCUMSTANCEINWHICHANARMYALLOFWHOSEMEMBERSAREBRAVEFLEESATTOPSPEEDBEFORETHEENEMYMAKESAMOVEIFTHESOLDIERSREALLYAREBRAVETHENTHISSURELYISNTTHEOUTCOMEANYOFTHEMWANTEDEACHWOULDHAVEPREFERREDTHATALLSTANDANDFIGHTWHATWEHAVEHERETHENISACASEINWHICHTHEINTERACTIONOFMANYINDIVIDUALLYRATIONALDECISIONMAKINGPROCESSESONEPROCESSPERSOLDIERPRODUCESANOUTCOMEINTENDEDBYNOONEMOSTARMIESTRYTOAVOIDTHISPROBLEMJUSTASCORTEZDIDSINCETHEYCANTUSUALLYMAKERETREATPHYSICALLYIMPOSSIBLETHEYMAKEITECONOMICALLYIMPOSSIBLETHEYSHOOTDESERTERSTHENSTANDINGANDFIGHTINGISEACHSOLDIERSINDIVIDUALLYRATIONALCOURSEOFACTIONAFTERALLBECAUSETHECOSTOFRUNNINGISSURETOBEATLEASTASHIGHASTHECOSTOFSTAYING
6) Key: FBTU. Plaintext: SGDRDRHSTZSHNMRZRQDBZKKDCAXOKZSNZMCZRUHUHCKXZBSDCTONMAXBNQSDYGZUDZBNLLNMZMCHMSDQDRSHMFTMCDQKXHMFKNFHBMNSHBDSGZSSGDRNKCHDQRZQDMNSLNSHUZSDCSNQDSQDZSITRSNQDUDMLZHMKXAXSGDHQQZSHNMZKZRRDRRLDMSNESGDCZMFDQRNEAZSSKDZMCAXSGDHQRDKEHMSDQDRSQZSGDQSGDXCHRBNUDQZRNTMCQDZRNMSNQTMZVZXAXQDZKHYHMFSGZSVGZSHSLZJDRRDMRDENQSGDLSNCNCDODMCRNMVGZSHSVHKKLZJDRDMRDENQNSGDQRSNCNZMCSGZSZKKNESGDNSGDQRBZMMNSHBDSGHRSNNDUDMZPTHSDAQZUDRNKCHDQLZXOQDEDQSNQTMQZSGDQSGZMGDQNHBZKKXATSONHMSKDRRKXCHDSQXHMFSNRSDLSGDNMBNLHMFSHCDZKKAXGHLRDKESGTRVDBNTKCHLZFHMDVHSGNTSBNMSQZCHBSHNMZBHQBTLRSZMBDHMVGHBGZMZQLXZKKNEVGNRDLDLADQRZQDAQZUDEKDDRZSSNORODDCADENQDSGDDMDLXLZJDRZLNUDHESGDRNKCHDQRQDZKKXZQDAQZUDSGDMSGHRRTQDKXHRMSSGDNTSBNLDZMXNESGDLVZMSDCDZBGVNTKCGZUDOQDEDQQDCSGZSZKKRSZMCZMCEHFGSVGZSVDGZUDGDQDSGDMHRZBZRDHMVGHBGSGDHMSDQZBSHNMNELZMXHMCHUHCTZKKXQZSHNMZKCDBHRHNMLZJHMFOQNBDRRDRNMDOQNBDRRODQRNKCHDQOQNCTBDRZMNTSBNLDHMSDMCDCAXMNNMDLNRSZQLHDRSQXSNZUNHCSGHROQNAKDLITRSZRBNQSDYCHCRHMBDSGDXBZMSTRTZKKXLZJDQDSQDZSOGXRHBZKKXHLONRRHAKDSGDXLZJDHSDBNMNLHBZKKXHLONRRHAKDSGDXRGNNSCDRDQSDQRSGDMRSZMCHMFZMCEHFGSHMFHRDZBGRNKCHDQRHMCHUHCTZKKXQZSHNMZKBNTQRDNEZBSHNMZESDQZKKADBZTRDSGDBNRSNEQTMMHMFHRRTQDSNADZSKDZRSZRGHFGZRSGDBNRSNERSZXHMF
```

As we can see, key `EAST` stands out from the rest, and the plaintext is readable.

## Algorithms used

The main program used can be found at the GitHub Repository. 

#### Constants

```cs
const string CipherText = "XHW...AGK";
const int KeyLength = 4;
const double CIdxConfideceTreshold = 0.057;

const char AlphabetStartLetter = 'A';
const int AlphabetLength = 26;
```

Cipher text here is omitted for brevity. Key length was found from the GCD analysis from first step.

#### Utility algorithms

```cs
public static char OffsetChar(char c, int offset)
{
    return (char)((c + offset + AlphabetLength - AlphabetStartLetter) % AlphabetLength + AlphabetStartLetter);
}

public static string OffsetText(IEnumerable<char> text, int offset)
{
    return new string(text.Select(c => OffsetChar(c, offset)).ToArray());
}
```

These methods transform text modulo 26 in the alphabet. In hindsight would have just worked with numbers 0..26, but now this program can work with raw text.

#### Character frequency analysis

```cs
public static Dictionary<char, int> AnalyzeCharFrequency(string text)
{
    var charFrequency = new Dictionary<char, int>();

    foreach (var ch in text)
    {
        if (!charFrequency.ContainsKey(ch))
        {
            charFrequency.Add(ch, 0);
        }

        charFrequency[ch]++;
    }

    return charFrequency;
}
```

This method takes a string, and counts how many times characters occur.

#### Brute force algorithm

```cs
public static (int, double) FindLikelyKeyOffset(string t1, string t2)
{
    var offset = 0;
    var coincidenceIdx = 0.0;
    for (int i = 0; i < AlphabetLength; i++)
    {
        // Add +1 to the alphabet. Loop around if it exceeds last letter.
        var newIc = CalculateMutualIC(t1, OffsetText(t2, i + 1));
        if (newIc > coincidenceIdx)
        {
            offset = i + 1;
            coincidenceIdx = newIc;
        }
    }

    return (offset, coincidenceIdx);
}

public static double CalculateMutualIC(string t1, string t2)
{
    var f1 = AnalyzeCharFrequency(t1);
    var f2 = AnalyzeCharFrequency(t2);

    var micTotal = Enumerable.Range(AlphabetStartLetter, AlphabetLength).Aggregate(0.0, (acc, val) =>
    {
        // If one or both of the letters do not exist, the product of multiplication equates to 0.
        if (f1.TryGetValue((char)val, out var fi1) && f2.TryGetValue((char)val, out var fi2))
        {
            return acc + fi1 * fi2;
        }

        return acc;
    });

    return micTotal / (t1.Length * t2.Length);
}
```

The result of the brute force algorithm is the offset between z values (zi - zj), and their mutual index of coincidence.

## Conclusion

The decrypted plaintext (with my idea for spaces placement) is:

```
THESE SITUATIONS AS RECALLED BY PLATO AND AS VIVIDLY ACTED UPON BY CORTEZ HAVE A COMMON AND INTERESTING UNDERLYING LOGIC NOTICE THAT THE SOLDIERS ARE NOT MOTIVATED TO RETREAT JUST OR EVEN MAINLY BY THE IRRATIONAL ASSESSMENT OF THE DANGERS OF BATTLE AND BY THEIR SELF INTEREST RATHER THEY DISCOVER A SOUND REASON TO RUN AWAY BY REALIZING THAT WHAT IT MAKES SENSE FOR THEM TO DO DEPENDS ON WHAT IT WILL MAKE SENSE FOR OTHERS TO DO AND THAT ALL OF THE OTHERS CANNOT ICE THIS TOO EVEN A QUITE BRAVE SOLDIER MAY PREFER TO RUN RATHER THAN HEROICALLY BUT POINTLESSLY DIE TRYING TO STEM THE ONCOMING TIDE ALL BY HIMSELF THUS WE COULD IMAGINE WITHOUT CONTRADICTION A CIRCUMSTANCE IN WHICH AN ARMY ALL OF WHOSE MEMBERS ARE BRAVE FLEES AT TOP SPEED BEFORE THE ENEMY MAKES A MOVE IF THE SOLDIERS REALLY ARE BRAVE THEN THIS SURELY ISNT THE OUTCOME ANY OF THEM WANTED EACH WOULD HAVE PREFERRED THAT ALL STAND AND FIGHT WHAT WE HAVE HERE THEN IS A CASE IN WHICH THE INTERACTION OF MANY INDIVIDUALLY RATIONAL DECISION MAKING PROCESSES ONE PROCESS PER SOLDIER PRODUCES AN OUTCOME INTENDED BY NO ONE MOST ARMIES TRY TO AVOID THIS PROBLEM JUST AS CORTEZ DID SINCE THEY CANT USUALLY MAKE RETREAT PHYSICALLY IMPOSSIBLE THEY MAKE IT ECONOMICALLY IMPOSSIBLE THEY SHOOT DESERTERS THEN STANDING AND FIGHTING IS EACH SOLDIERS INDIVIDUALLY RATIONAL COURSE OF ACTION AFTER ALL BECAUSE THE COST OF RUNNING IS SURE TO BE AT LEAST AS HIGH AS THE COST OF STAYING
```

